# 电商分析平台

## 项目概述
对用户访问电商平台的的行为进行分析。在访问电商网站时，我们的一些访问行为会产生相应的埋点日志（例如点击、搜索、下单、购买等），这些埋点日志会被发送给电商的后台服务器，大数据部门会根据这些埋点日志中的数据分析用户的访问行为，并得出一系列的统计指标，借助这些统计指标指导电商平台中的商品推荐、广告推送和网站优化等工作。上报到服务器的埋点日志数据会经过数据采集、过滤、存储、分析、可视化这一完整流程，电商平台通过对海量用户行为数据的分析，可以对用户建立精准的用户画像，同时，对于用户行为的分析，也可以帮助电商网站找到网站的优化思路，从而在海量用户数据的基础上对网站进行改进和完善。


## 数据解析
#### 离线数据源
* 动作表(user_visit_action)

|字段名称|解释|备注|
|:-:|:-:|:-:|
|date|动作日期|-|
|user_id|用户ID|-|
|session_id|sessionID|-|
|page_id|页面ID|-|
|action_time|动作时间|-|
|search_keyword|查询词|搜索行为|
|click_category_id|点击类别ID|点击行为|
|click_product_id|点击产品ID|点击行为|
|order_category_ids|订单类别ID集合|下单行为|
|order_product_ids|订单产品ID集合|下单行为|
|pay_category_ids|付款类别ID集合|购买行为|
|pay_product_ids|付款产品ID集合|购买行为|
|city_id|城市ID|-|

* 用户表(user_info)

|字段名称|解释|备注|
|:-:|:-:|:-:|
|user_id|用户ID|-|
|username|用户名称|-|
|name|名称|-|
|age|年龄|-|
|professional|职业|-|
|city|城市|-|
|sex|性别|-|

* 物品表(product_info)

|字段名称|解释|备注|
|:-:|:-:|:-:|
|product_id|物品ID|-|
|product_name|物品名称|-|
|extend_info|额外信息|0:自营; 1:第三方;|

#### 实时数据源

|字段名称|解释|备注|
|:-:|:-:|:-:|
|timestamp|动作时间|毫秒|
|province|省份|-|
|city|城市|-|
|user_id|用户ID|-|
|adid|广告ID|-|



## 项目架构
* mock模块：模拟数据生成
* common模块：公共模块（基本工具类）
* analysis模块：数据分析模块


## 项目需求

### 需求模块一：用户访问session统计
#### 一些概念：
* session：用户从进入网站到离开网站的一次完整访问过程。1个session会在动作表中对应多条数据。
* action：用户在一次session中的访问行为（点击、搜索、下单、付款）。一个userID会对应多个session，一个session会对应多个action。
* 访问步长：1个session中action的个数。
* 访问时长：session的最早时间与最晚时间之差。
* 页面单跳转化率：

##### 需求一：session访问步长、访问时长占比统计
* 需求目的：
    > 统计出符合筛选条件的session中，访问时长在1s~3s、4s~6s、7s~9s、10s~30s、30s~60s、1m~3m、3m~10m、10m~30m、30m，访问步长在1_3、4_6、…以上各个范围内的各种session的占比。
* 实现思路：
    > user_visit_action与user_info做join，然后根据筛选条件过滤数据，设置累加器。
* 技术要点：
    > 累加器
* 操作步骤：
    1. 从user_visit_action表中获取用户行为数据；从user_info表中获取用户信息数据；
    2. 以sessionID作为key，聚合用户行为数据；
    3. 用user_id作为键，将聚合后的用户行为数据与用户信息数据做join，将用户信息添加到数据集；
    4. 根据筛选条件过滤数据；
    5. 定义累加器；

##### 需求二：按比例随机抽取session
* 需求目的：在符号过滤条件的session中，按照时间比例随机抽取100个session。当存在若干天的数据时，100个session抽取指标在天之间平均分配，在一天之中，根据某个小时的session数量在一天中总session数量中的占比决定这个小时抽取多少个session。
* 实现思路：
    1. 抽取数量：统计每天的session数量和每小时的session数量，然后根据占比和要抽取的session总数，得出具体某天要抽取的session数量和具体某小时要抽取的session数量。
        公式：某小时要抽取的session数量 = （这一小时的session数量/这一天的session数量）* 这一天要抽取的session数量
    2. 随机性：明确一个小时抽取n个session后，生成一个n个随机数组成的列表，以此作为要抽取的session的索引列表。
* 操作步骤：
    1. 明确一共要抽取多少session；
    2. 明确具体某天要抽取多少session；
    3. 明确每天有多少session；
    4. 明确每小时有多少session；
    5. 明确每小时抽取多少session；
    6. 根据每小时抽取数量生成随机索引；
    7. 按照随机索引抽取实际的一个小时中的session；

##### 需求三：Top10热门品类统计
* 需求目的：
* 实现思路：
* 技术要点：

##### 需求四：Top10热门品类活跃session统计
* 需求目的：
* 实现思路：
* 技术要点：

### 需求模块二：页面单跳转化率统计
##### 需求五：页面单跳转化率统计
* 需求目的：
* 实现思路：
* 技术要点：

### 需求模块三：区域热门商品统计
##### 需求六：区域Top3热门商品统计
* 需求目的：
* 实现思路：
* 技术要点：


### 需求模块四：广告流量实时统计
##### 需求七：动态黑名单实时统计
##### 需求八：各省各城市广告流量实时统计
##### 需求九：各省热门广告实时统计
##### 需求十：最近1小时广告点击量实时统计



